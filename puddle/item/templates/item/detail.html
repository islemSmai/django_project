{% extends 'core/base.html' %}
{% block title %} {{item.name}} {% endblock %}
{% block content %}
<div class="containt-item gap-6 px-6 py-6">
   {% if images%}
    <div class="images">
        {% for image in images %}
        <img src="{{image.gallery.url}}" class="rounded-xl img-gallery" onclick="updateOriginalImage(this)">
        {% endfor %}
    </div>
    {% endif %}
    <div>
        <img src="{{item.image.url}}" id="original-image" class="rounded-xl img-principale">
    </div>
    <div class=" p-6 rounded-xl text-item">
        <h1 class="mb-6 text-3xl title-item-detail">{{item.name}}</h1>
        <p class=""><strong>Price : </strong>{{item.price}} DTN</p>
        <p class=""><strong>Seller : </strong>{{item.shop.created_by.username}}</p>
        {% if item.description %}
        <p class="">
            <strong class="">Description : </strong>
            <br>{{item.description}}
        </p>
        {% endif %}
        {% if request.user == item.category.shop.created_by %}
        <div class="">
            <a class="fancy inline-block mt-6 px-6 py-3" href="{% url 'item:edit' item.id%}">
                <span class="top-key"></span>
                <span class="text">Edit</span>
                <span class="bottom-key-1"></span>
                <span class="bottom-key-2"></span>
            </a>
            <a class="fancy inline-block mt-6 px-6 py-3"  data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                <span class="top-key"></span>
                <span class="text">Delete</span>
                <span class="bottom-key-1"></span>
                <span class="bottom-key-2"></span>
            </a>
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="background-color: #2d3748; width: 70%;">
            <div class="modal-header" style="border-bottom: none;">
                <h5 class="modal-title" style="color: #fff;" id="confirmDeleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="color: #fff;" >
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer" style="border-top: none;">
                <!-- Close button -->
                <button type="button" class="div-button-card cancel-button" data-bs-dismiss="modal">
                    
                    <img src="../../../media/image/close.png" class="delete-svgIcon">
                </button>
                
                <!-- Delete button -->
                <form id="delete-form" action="{% url 'item:delete' item.id %}" method="POST">
                    {% csrf_token %}
                    <!--                    <button type="submit" class="btn btn-danger">Delete</button>
-->
                    <button class="div-button-card delete-button"  type="submit">
                        <img src="../../../media/image/white_delete.png" class="delete-svgIcon">
                      </button>
                </form>
            </div>
        </div>
    </div>
</div>

        </div>
        {% else%}
        <a href="{% url 'conversation:new' item.id %}" class="inline-block mt-6 px-6 py-3 text-lg font-semibol bg-teal-500 text-white rounded-xl hover:bg-teal-700">
            Contact seller
        </a>
        <form action="{% url 'user_payment:payment'%}?id={{item.id}}" method="POST">
            {% csrf_token %}

            <button class="inline-block mt-6 px-6 py-3 text-lg font-semibol bg-teal-500 text-white rounded-xl hover:bg-teal-700" id="checkout-button">Payment</button>
            
        </form>
        {% endif %}

    </div>
</div>

<script type="text/javascript">
    var stripe = Stripe('{{ stripe_public_key }}');

    var checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function () {
        fetch('/payment/', {
            method: 'POST',
        })
        .then(function (response) {
            return response.json();
        })
        .then(function (sessionId) {
            return stripe.redirectToCheckout({ sessionId: sessionId.id });
        })
        .then(function (result) {
            if (result.error) {
                alert(result.error.message);
            }
        })
        .catch(function (error) {
            console.error('Error:', error);
        });
    });
</script>
<div class="mt-6 px-6 py-12 bg-gray-100 rounded-xl">
    <h2 class="mb-12 text-2xl text-center">Related items</h2>
    <div class="grid grid-cols-3 gap-3">
       {% for item in related_items %}
       <div class="card-cont">
        <a href="{% url 'item:detail' item.id %}">
            <div class="card-img-div">
                <img src="{{item.image.url}}" class="img-item-card">
               </div>
           <div class="cont-disc rounded-b-xl">
            <h2 class="text-2xl"> 
                {{item.name}}
            </h2>
            <p class="">
                Price: {{item.price}}
            </p>
           </div>
        </a>
       </div>
       {% endfor %} 
    </div>
</div>
<script>
    function updateOriginalImage(thumbnail) {
        var originalImage = document.getElementById('original-image');
        originalImage.src = thumbnail.src;
    }
</script>

{% endblock %}